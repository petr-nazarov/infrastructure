- type: custom-api
  title: Gatus
  cache: 5m
  options:
    base-url: http://status.${TOP_LOCAL_DOMAIN}
    style: compact
    duration: 24h
    groupFilter: ""
    compactMetric: uptime
    showFailingOnly: true
    showOnlyConfigured: false
  template: "{{/* Required config options */}}\n{{ $baseURL := .Options.StringOr \"base-url\" \"\" }}\n\n{{/* Optional config options */}}\n{{ $duration := .Options.StringOr \"duration\" \"24h\" }}\n{{ $style := .Options.StringOr \"style\" \"full\" }}\n{{ $groupFilter := .Options.StringOr \"group\" \"\" }}\n{{ $compactMetric := .Options.StringOr \"compact-metric\" \"uptime\" }}\n{{ $showFailingOnly := .Options.BoolOr \"show-failing-only\" false }}\n{{ $showOnlyConfigured := .Options.BoolOr \"show-only-configured\" false }}\n\n\n{{/* Error message template */}}\n{{ define \"errorMsg\" }}\n  <div class=\"widget-error-header\">\n    <div class=\"color-negative size-h3\">ERROR</div>\n    <svg class=\"widget-error-icon\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\">\n      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z\"></path>\n    </svg>\n  </div>\n  <p class=\"break-all\">{{ . }}</p>\n{{ end }}\n\n{{/* Popover template */}}\n{{ define \"popover\" }}\n  <div data-popover-html>\n    <div style=\"margin: 5px;\">\n      <p class=\"margin-top-12\" style=\"overflow-y: auto; text-align: justify; max-height: 20rem;\">\n        {{ range .Array \"conditionResults\" }}\n          {{ if (.Bool \"success\") }}\n            <p class=\"color-positive\">{{ .String \"condition\" }}</p>\n          {{ else }}\n            <p class=\"color-negative\">{{ .String \"condition\" }}</p>\n          {{ end }}\n        {{ end }}\n      </p>\n    </div>\n  </div>\n{{ end }}\n\n{{ $endpoints := newRequest (print $baseURL \"/api/v1/endpoints/statuses\") \n    | getResponse }}\n\n{{ $options := .Options }}\n{{ $displayedItems := 0 }}\n{{ if eq $style \"compact\" }}\n  <ul class=\"dynamic-columns list-gap-8 \">\n  {{ range $i, $endpoint := $endpoints.JSON.Array \"\" }}\n      {{ $name := $endpoint.String \"name\" }}\n      {{ $key := $endpoint.String \"key\" }}\n      {{ $group := $endpoint.String \"group\" }}\n      {{ $linkUrlOption := $options.StringOr (concat $name \"-url\") \"\" }}\n      {{ $linkUrl := $options.StringOr (concat $name \"-url\") (concat $baseURL \"/endpoints/\" $key) }}\n      {{ $lastResult := index ( $endpoint.Array \"results\" ) (sub (len ($endpoint.Array \"results\")) 1) }}\n      {{ $latestSuccess := $lastResult.Bool \"success\" }}\n\n      {{ if and $groupFilter (not (eq $groupFilter $group)) }} {{ continue }} {{ end }}\n      {{ if and $showFailingOnly $latestSuccess }} {{ continue }} {{ end }}\n      {{ if and $showOnlyConfigured (eq $linkUrlOption \"\") }} {{ continue }} {{ end }}\n      {{ $displayedItems = add $displayedItems 1 }}\n\n      {{ $responseTime := \"\" }}\n      {{ $uptime := \"\" }}\n      {{ $uptimeValue := \"\" }}\n\n      {{ if eq $compactMetric \"uptime\" }}\n        {{ $uptime = newRequest (print $baseURL \"/api/v1/endpoints/\" $key \"/uptimes/\" $duration )\n            | getResponse }}\n        {{ $uptimeValue = mul 100 ($uptime.JSON.Float \"\") }}\n      {{ else }}\n        {{ $responseTime = newRequest (print $baseURL \"/api/v1/endpoints/\" $key \"/response-times/\" $duration )\n            | getResponse }}\n      {{ end }}\n\n      <div class=\"flex items-center gap-12\">\n        <a class=\"size-title-dynamic color-highlight text-truncate block grow\" href=\"{{ $linkUrl | safeURL }}\" target=\"_blank\" rel=\"noreferrer\">{{ $name }}</a>\n        <a href=\"{{ $linkUrl | safeURL }}\" target=\"_blank\" rel=\"noreferrer\">\n          {{ if eq $compactMetric \"uptime\" }}\n            <div>{{ printf \"%.1f\" $uptimeValue }}%</div>\n          {{ else }}\n            <div>{{ $responseTime.JSON.Int \"\" }}ms</div>\n          {{ end }}\n        </a>\n\n        {{ if $latestSuccess }}\n          <div class=\"monitor-site-status-icon-compact\">\n            <a href=\"{{ $linkUrl | safeURL }}\" target=\"_blank\" rel=\"noreferrer\">\n              <div data-popover-type=\"html\" data-popover-position=\"above\" data-popover-show-delay=\"500\" style=\"align-content: center;\">\n                {{ template \"popover\" $lastResult }}\n                <svg fill=\"var(--color-positive)\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\">\n                  <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z\" clip-rule=\"evenodd\" />\n                </svg>\n              </div>\n            </a>\n          </div>\n        {{ else }}\n          <div class=\"monitor-site-status-icon-compact\">\n            <a href=\"{{ $linkUrl | safeURL }}\" target=\"_blank\" rel=\"noreferrer\">\n              <div data-popover-type=\"html\" data-popover-position=\"above\" data-popover-show-delay=\"500\" style=\"align-content: center;\">\n                {{ template \"popover\" $lastResult }}\n                <svg fill=\"var(--color-negative)\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\">\n                  <path fill-rule=\"evenodd\" d=\"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495ZM10 5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 5Zm0 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z\" clip-rule=\"evenodd\" />\n                </svg>\n              </div>\n            </a>\n          </div>\n        {{ end }}\n\n      </div>\n    {{ end }}\n  </ul>\n{{ else }}\n\n  <ul class=\"dynamic-columns list-gap-20 list-with-separator\">\n  {{ range $i, $endpoint := $endpoints.JSON.Array \"\" }}\n      {{ $name := $endpoint.String \"name\" }}\n      {{ $key := $endpoint.String \"key\" }}\n      {{ $group := $endpoint.String \"group\" }}\n      {{ $icon := $options.StringOr $name \"\" }}\n      {{ $linkUrlOption := $options.StringOr (concat $name \"-url\") \"\" }}\n      {{ $linkUrl := $options.StringOr (concat $name \"-url\") (concat $baseURL \"/endpoints/\" $key) }}\n      {{ $lastResult := index ( $endpoint.Array \"results\" ) (sub (len ($endpoint.Array \"results\")) 1) }}\n      {{ $latestSuccess := $lastResult.Bool \"success\" }}\n\n      {{ if and $groupFilter (not (eq $groupFilter $group)) }} {{ continue }} {{ end }}\n      {{ if and $showFailingOnly $latestSuccess }} {{ continue }} {{ end }}\n      {{ if and $showOnlyConfigured (or (eq $linkUrlOption \"\") (eq $icon \"\")) }} {{ continue }} {{ end }}\n      {{ $displayedItems = add $displayedItems 1 }}\n\n      {{ $uptime := newRequest (print $baseURL \"/api/v1/endpoints/\" $key \"/uptimes/\" $duration )\n          | getResponse }}\n      {{ $responseTime := newRequest (print $baseURL \"/api/v1/endpoints/\" $key \"/response-times/\" $duration )\n          | getResponse }}\n\n      {{ $uptimeValue := mul 100 ($uptime.JSON.Float \"\") }}\n\n      {{ $iconUrl := \"\" }}\n      {{ if $icon }}\n        {{ $iconPrefix := findMatch \"^(si|di|mdi|sh):\" $icon }}\n        {{ $iconBase := replaceMatches \"^(si|di|mdi|sh):\" \"\" $icon }}\n\n        {{ $iconExt := findMatch \"\\\\.[a-z]+$\" $iconBase }}\n        {{ $iconExt := replaceMatches \"\\\\.\" \"\" $iconExt }}\n        {{ $iconBase = replaceMatches \"\\\\.[a-z]+$\" \"\" $iconBase }}\n        {{ if eq $iconExt \"\" }} {{ $iconExt = \"svg\" }} {{ end }}\n\n        {{ if eq $iconPrefix \"si:\" }}\n          {{ $iconUrl = concat \"https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/\" $iconBase \".svg\" }}\n        {{ else if eq $iconPrefix \"di:\" }}\n          {{ $iconUrl = concat \"https://cdn.jsdelivr.net/gh/homarr-labs/dashboard-icons/\" $iconExt \"/\" $iconBase \".\" $iconExt }}\n        {{ else if eq $iconPrefix \"mdi:\" }}\n          {{ $iconUrl = concat \"https://cdn.jsdelivr.net/npm/@mdi/svg@latest/svg/\" $iconBase \".svg\" }}\n        {{ else if eq $iconPrefix \"sh:\" }}\n          {{ $iconUrl = concat \"https://cdn.jsdelivr.net/gh/selfhst/icons/\" $iconExt \"/\" $iconBase \".\" $iconExt }}\n        {{ else }}\n          {{ $iconUrl = $icon }}\n        {{ end }}\n      {{ end }}\n\n      <div class=\"monitor-site flex items-center gap-15\">\n        {{ if $iconUrl }}\n          <a href=\"{{ $linkUrl | safeURL }}\" target=\"_blank\" rel=\"noreferrer\">\n            <img class=\"monitor-site-icon\" src=\"{{ $iconUrl | safeURL }}\" alt=\"\" loading=\"lazy\">\n          </a>\n        {{ end }}\n        <div class=\"grow min-width-0\">\n          <a class=\"size-h3 color-highlight text-truncate block\" href=\"{{ $linkUrl | safeURL }}\" target=\"_blank\" rel=\"noreferrer\">{{ $name }}</a>\n\n          <a href=\"{{ $linkUrl | safeURL }}\" target=\"_blank\" rel=\"noreferrer\">\n            <ul class=\"list-horizontal-text\">\n              <li class=\"{{ if not $latestSuccess }}color-negative{{ end }}\">{{ printf \"%.1f\" $uptimeValue }}%</li>\n              <li>{{ $responseTime.JSON.Int \"\" }}ms</li>\n            </ul>\n          </a>\n        </div>\n\n        {{ if $latestSuccess }}\n          <div class=\"monitor-site-status-icon\">\n            <a href=\"{{ $linkUrl | safeURL }}\" target=\"_blank\" rel=\"noreferrer\">\n              <div data-popover-type=\"html\" data-popover-position=\"above\" data-popover-show-delay=\"500\" style=\"align-content: center;\">\n                {{ template \"popover\" $lastResult }}\n                <svg fill=\"var(--color-positive)\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\">\n                  <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z\" clip-rule=\"evenodd\" />\n                </svg>\n              </div>\n            </a>\n          </div>\n        {{ else }}\n          <div class=\"monitor-site-status-icon\">\n            <a href=\"{{ $linkUrl | safeURL }}\" target=\"_blank\" rel=\"noreferrer\">\n              <div data-popover-type=\"html\" data-popover-position=\"above\" data-popover-show-delay=\"500\" style=\"align-content: center;\">\n                {{ template \"popover\" $lastResult }}\n                <svg fill=\"var(--color-negative)\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\">\n                  <path fill-rule=\"evenodd\" d=\"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495ZM10 5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 5Zm0 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z\" clip-rule=\"evenodd\" />\n                </svg>\n              </div>\n            </a>\n          </div>\n        {{ end }}\n\n      </div>\n    {{ end }}\n  </ul>\n{{ end }}\n\n{{ if eq $displayedItems 0 }}\n  <div class=\"flex items-center justify-center gap-10 padding-block-5\">\n    <p>All sites are online</p>\n    <svg class=\"shrink-0\" style=\"width: 1.7rem;\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"var(--color-positive)\">\n      <path fill-rule=\"evenodd\" d=\"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z\" clip-rule=\"evenodd\" />\n    </svg>\n  </div>\n{{ end }}\n"
